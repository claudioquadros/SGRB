{% extends 'base.html' %}

{% block content %}
  <form method="get" action="{% url 'insemination_list' %}">
    <div class="row g-2 align-items-end mb-3">

      <div class="col-md-4">
        <label for="farm" class="form-label">Propriedade</label>
        <select name="farm" id="farm" class="form-select" onchange="this.form.submit()">
          <option value="">-- Todas --</option>
          {% for f in farms %}
            <option value="{{ f.id }}" {% if request.GET.farm|stringformat:"s" == f.id|stringformat:"s" %}selected{% endif %}>
              {{ f.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-4">
        <label for="name" class="form-label">Nome</label>
        <div class="input-group">
          <input type="text" class="form-control" id="name" name="name"
                placeholder="Nome" value="{{ request.GET.name }}">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </div>

      <div class="col-md-4 d-flex gap-2">
        <a href="{% url 'insemination_list' %}" class="btn btn-outline-secondary">
          Limpar
        </a>
        {% if perms.inseminations.add_insemination %}
          <a href="{% url 'insemination_create' %}?{{ request.GET.urlencode }}" class="btn btn-success">
            <i class="bi bi-plus"></i> Nova Inseminação
          </a>
        {% endif %}
      </div>
    </div>
  </form>

    <div class="card">
      <div class="card-body">
        {% if inseminations %}
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Animal</th>
                <th>Data da Inseminação</th>
                <th>Touro</th>
                <th>Verificar a Prenhez</th>
                <th>Verificado</th>
                <th>Está Prenha?</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for insemination in inseminations %}
                <tr>
                  <td>{{ insemination.animal.name }}</td>
                  <td>{{ insemination.date_of_insemination|date:'d/m/Y' }}</td>
                  <td>
                    {% if insemination.bull %}
                      {{ insemination.bull }}
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>
                    {% if insemination.expected_pregnancy %}
                      {{ insemination.expected_pregnancy|date:'d/m/Y' }}
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>
                    {% if insemination.pregnancy_check %}
                      {{ insemination.pregnancy_check|date:'d/m/Y' }}
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>
                    {% if insemination.is_pregnant %}
                      {{ insemination.get_is_pregnant_display }}
                    {% else %}
                      Não Verificado
                    {% endif %}
                  </td>
                  <td>
                    {% if perms.inseminations.view_insemination %}
                      <a href="{% url 'insemination_detail' insemination.id %}?{{ request.GET.urlencode }}" class="btn btn-info btn-sm">
                        <i class="bi bi-eye"></i>
                      </a>
                    {% endif %}
                    {% if perms.inseminations.change_insemination %}
                      <a href="{% url 'insemination_check' insemination.id %}?{{ request.GET.urlencode }}" class="btn btn-warning btn-sm">
                        <i class="bi bi-check-lg"></i>
                      </a>
                    {% endif %}
                    {% if perms.inseminations.delete_insemination %}
                      {% if insemination.is_pregnant is None %}
                        <a href="{% url 'insemination_delete' insemination.id %}?{{ request.GET.urlencode }}" class="btn btn-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </a>
                      {% endif %}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>Nenhuma inseminação registrada.</p>
        {% endif %}
      </div>
    </div>
  </div>
  {% include 'components/_pagination.html' %}
{% endblock %}
